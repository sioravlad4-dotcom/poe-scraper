# –ù–∞–∑–≤–∞ –Ω–∞—à–æ—ó –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó
name: Scrape POE Schedule

# –£–º–æ–≤–∏ –∑–∞–ø—É—Å–∫—É
on:
  # 1. –ó–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º: (—Ç—É—Ç '0 */1 * * *' –æ–∑–Ω–∞—á–∞—î '–æ 00 —Ö–≤–∏–ª–∏–Ω –∫–æ–∂–Ω–æ—ó –≥–æ–¥–∏–Ω–∏')
  # –í–∏ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –Ω–∞ '0 */2 * * *' (–∫–æ–∂–Ω—ñ 2 –≥–æ–¥–∏–Ω–∏)
  schedule:
    - cron: '0 */1 * * *'
    
  # 2. –î–æ–∑–≤–æ–ª—è—î –∑–∞–ø—É—Å–∫–∞—Ç–∏ –≤—Ä—É—á–Ω—É (–∫–Ω–æ–ø–∫–∞ "Run workflow" —É –≤–∫–ª–∞–¥—Ü—ñ "Actions")
  workflow_dispatch:

jobs:
  scrape:
    # –ó–∞–ø—É—Å–∫–∞—î–º–æ –Ω–∞ —Å–≤—ñ–∂–æ–º—É —Å–µ—Ä–≤–µ—Ä—ñ Ubuntu
    runs-on: ubuntu-latest

    steps:
      # 1. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∫–æ–¥ –∑ –Ω–∞—à–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
      - name: Check out repository
        uses: actions/checkout@v4

      # 2. –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Å–≤—ñ–∂—É –≤–µ—Ä—Å—ñ—é Python

      # 3. –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ Chrome (—Ü–µ –æ—Ñ—ñ—Ü—ñ–π–Ω–∞ –¥—ñ—è –≤—ñ–¥ Google)
      - name: Setup Chrome
        uses: browser-actions/setup-chrome@v1
        with:
          chrome-version: stable # –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞–±—ñ–ª—å–Ω—É –≤–µ—Ä—Å—ñ—é Chrome

      # 4. –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –Ω–∞—à—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –∑ requirements.txt
      - name: Install Python dependencies
        run: pip install -r requirements.txt

      # 5. –ó–∞–ø—É—Å–∫–∞—î–º–æ –Ω–∞—à —Å–∫—Ä–∏–ø—Ç
      - name: Run scraper
        run: python poe.py
        # üí° –ü–µ—Ä–µ–¥–∞—î–º–æ "—Å–µ–∫—Ä–µ—Ç–∏" —É —Å–∫—Ä–∏–ø—Ç
        env:
          WORDPRESS_URL: ${{ secrets.WORDPRESS_URL }}
          WORDPRESS_SECRET_KEY: ${{ secrets.WORDPRESS_SECRET_KEY }}
